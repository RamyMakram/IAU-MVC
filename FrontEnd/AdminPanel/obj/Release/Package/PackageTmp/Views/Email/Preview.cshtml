@model IAUAdmin.DTO.Entity.ReqestDTO
@{
	ViewBag.Title = "Preview";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Summernote css -->
<link href="~/assets/libs/summernote/summernote-bs4.min.css" rel="stylesheet" type="text/css" />


<div class="row">
	<div class="col-12">
		<div class="mb-3">
			@*<span style="display:none" id="NONE">@Model.Request_Data_ID</span>*@
			<div class="card">
				<div class="card-body">
					<div class="media mb-4">
						<img class="d-flex mr-3 rounded-circle avatar-sm" src="~/assets/images/users/avatar-2.jpg" alt="Generic placeholder image">
						<div class="media-body">
							<h5 class="font-size-14 mt-1">Humberto D. Champion</h5>
							<small class="text-muted">support@domain.com</small>
						</div>
					</div>
					<div style="display:flex;align-items:center;justify-content:center;direction:ltr">
						<div id="PDFView" style="direction:ltr;height:600px;overflow-y:auto">

						</div>
					</div>
				</div>
				<div class="card-body">
					<div class="media mb-4">
						<img class="d-flex mr-3 rounded-circle avatar-sm" src="~/assets/images/users/avatar-2.jpg" alt="Generic placeholder image">
						<div class="media-body">
							<h5 class="font-size-14 mt-1">Humberto D. Champion</h5>
							<small class="text-muted">support@domain.com</small>
						</div>
					</div>

					<h4 class="mt-0 font-size-16">This Week's Top Stories</h4>

					<p>Dear Lorem Ipsum,</p>
					<p>
						Praesent dui ex, dapibus eget mauris ut, finibus vestibulum enim. Quisque arcu leo, facilisis in fringilla id, luctus in tortor. Nunc vestibulum est quis orci varius viverra. Curabitur dictum volutpat massa vulputate molestie. In at felis ac velit maximus convallis.
					</p>
					<p>Sed elementum turpis eu lorem interdum, sed porttitor eros commodo. Nam eu venenatis tortor, id lacinia diam. Sed aliquam in dui et porta. Sed bibendum orci non tincidunt ultrices. Vivamus fringilla, mi lacinia dapibus condimentum, ipsum urna lacinia lacus, vel tincidunt mi nibh sit amet lorem.</p>
					<p>Sincerly,</p>
					<hr />

					<div class="row">
						<div class="col-xl-2 col-6">
							<div class="card">
								<img class="card-img-top img-fluid" src="~/assets/images/small/img-3.jpg" alt="Card image cap">
								<div class="py-2 text-center">
									<a href="" class="font-weight-medium">Download</a>
								</div>
							</div>
						</div>
						<div class="col-xl-2 col-6">
							<div class="card">
								<img class="card-img-top img-fluid" src="~/assets/images/small/img-4.jpg" alt="Card image cap">
								<div class="py-2 text-center">
									<a href="" class="font-weight-medium">Download</a>
								</div>
							</div>
						</div>
					</div>

					@*<a href="@Url.Action("EmailRead", "Email")" class="btn btn-secondary waves-effect mt-4"><i class="mdi mdi-reply"></i> Redirect To Service</a>*@
				</div>

			</div>
		</div>

	</div>
</div>
<!-- JAVASCRIPT -->
<script src="~/assets/libs/jquery/jquery.min.js"></script>
<script src="~/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="~/assets/libs/metismenu/metisMenu.min.js"></script>
<script src="~/assets/libs/simplebar/simplebar.min.js"></script>
<script src="~/assets/libs/node-waves/waves.min.js"></script>
<script src="~/assets/js/lang/jquery.multiLanguage.js"></script>

<!-- Summernote js -->
<script src="~/assets/libs/summernote/summernote-bs4.min.js"></script>

<!-- email summernote init -->
<script src="~/assets/js/pages/email-summernote.init.js"></script>

<!-- App js -->
<script src="~/assets/js/app.js"></script>
<script src="~/assets/js/pdf.js"></script>
<script src="~/assets/js/pdf.worker.js"></script>
<script>
	$(document).ready(function () {
		//var ID = document.getElementById('NONE').innerText??"33"
		var ID = 33;
		$.ajax('/Email/RequestFiles?ID=33')
			//.then(resp => resp.blob())
			.then(blob => {
				var pdfData_ = window.atob(blob);
				var pdfjsLib = window['pdfjs-dist/build/pdf'];
				pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs-dist/build/pdf/pdf.worker.js';
				var loadingTask = pdfjsLib.getDocument({ data: pdfData_ });
				var body = document.getElementById('PDFView')
				loadingTask.promise.then(function (pdf) {
					let pagenum = pdf.numPages;
					console.log(pagenum)
					for (let i = 1; i <= pagenum; i++) {
						pdf.getPage(i).then(function (page) {
							var viewport = page.getViewport({ scale: 1 });
							var canvas = document.createElement('canvas', { id: 'canvas' + i, style: "direction: ltr !important;" })
							body.appendChild(canvas)
							var context = canvas.getContext('2d');
							canvas.height = viewport.height;
							canvas.width = viewport.width;
							var renderContext = {
								canvasContext: context,
								viewport: viewport
							};
							var renderTask = page.render(renderContext);
							renderTask.promise.then(function () {
								//$('#padf').removeClass('pdfnotloaded')
								//document.getElementById('loadingimg').style.display = "none";

							});
						});

					}
				}, function (reason) {
					console.error(reason);
				});

			})
			.catch(() => alert('oh no!'));
	})

</script>