@model IAUAdmin.DTO.Entity.ReqestDTO
@using System.Configuration;
@{
	ViewBag.pTitle = "Requests";
	ViewBag.pageTitle = "All Requests";
	ViewBag.Title = "Preview Request";
	ViewBag.arTitle = "الطلبات";
	ViewBag.arpageTitle = "الطلبات";
	ViewBag.arpTitle = "استعراض الطلب";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Summernote css -->
<link href="~/assets/libs/summernote/summernote-bs4.min.css" rel="stylesheet" type="text/css" />

<!-- select2 css -->
<link href="~/assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
<!-- Summernote css -->
<link href="~/assets/libs/summernote/summernote-bs4.min.css" rel="stylesheet" type="text/css" />
<!-- Sweet Alert-->
<link href="~/assets/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />
<!-- dropzone css -->
<link href="~/assets/libs/dropzone/min/dropzone.min.css" rel="stylesheet" type="text/css" />
<style>

	.nav-tabs {
		/*box-shadow: 0 2px 2px 0 rgba(0,0,0,0.14), 0 3px 1px -2px rgba(0,0,0,0.12), 0 1px 5px 0 rgba(0,0,0,0.2);*/
		border: none;
	}

		.nav-tabs .nav-link {
			border: none;
			border-radius: 0;
			transition: color .2s ease-out;
		}

	.tabs-dark .nav-link {
		color: #fff;
	}

	.tabs-light .nav-link {
		color: rgba(0,0,0,.5);
	}

	.tabs-dark .nav-link:not(.active):hover {
		color: #aeb0b3;
	}

	.tabs-light .nav-link:not(.active):hover {
		color: #495057;
	}

	.nav-pills .nav-link {
		border-radius: 2px;
		color: #495057;
		transition: color .2s ease-out, box-shadow .2s;
	}

		.nav-pills .nav-link:hover {
			box-shadow: 0 2px 2px 0 rgba(0,0,0,0.14), 0 3px 1px -2px rgba(0,0,0,0.12), 0 1px 5px 0 rgba(0,0,0,0.2);
		}

	.nav-pills .nav-item {
		margin: 0 5px;
	}

	.nav-pills.pills-dark .nav-link.active {
		background-color: #343a40 !important;
		box-shadow: 0 2px 2px 0 rgba(0,0,0,0.14), 0 3px 1px -2px rgba(0,0,0,0.12), 0 1px 5px 0 rgba(0,0,0,0.2);
	}

	.nav-pills.pills-dark .nav-link:not(.active):hover {
		color: #1d1e22;
	}

	.tabs-marker .nav-link {
		position: relative;
	}

		.tabs-marker .nav-link.active .marker {
			height: 30px;
			width: 30px;
			left: 50%;
			bottom: -30px;
			transform: translatex(-50%);
			position: absolute;
			overflow: hidden;
		}

			.tabs-marker .nav-link.active .marker:after {
				content: "";
				height: 15px;
				width: 15px;
				top: -8px;
				left: 50%;
				transform: rotate(45deg) translatex(-50%);
				transform-origin: left;
				background-color: #4f693a !important;
				box-shadow: 0 2px 2px 0 rgba(0,0,0,0.14), 0 3px 1px -2px rgba(0,0,0,0.12), 0 1px 5px 0 rgba(0,0,0,0.2);
				position: absolute;
			}
</style>
<style>
	.constainDocs[dir='rtl'] {
		border-left: 2px dashed;
		border-left-color: black;
	}

	.constainDocs[dir='ltr'] {
		border-right: 2px dashed;
		border-right-color: black;
	}

	.data-Comment {
		display: none;
	}

		.data-Comment.active {
			display: block;
		}

	.text {
		height: 253px;
		border: 1px dashed black;
		border-radius: 0 25px 25px 0;
		padding: 15px;
		margin: 15px 0;
		overflow: auto;
	}

		.text[dir='ltr'] {
			border-radius: 25px 0 0px 25px;
		}

	.constainDocs {
		width: 100%;
		height: 150px;
		overflow-x: auto;
		flex-direction: column;
		display: flex !important;
	}

		.constainDocs .col-3 {
			display: flex;
			align-items: center;
		}

			.constainDocs .col-3 .card {
				margin: 15px 0 !important;
			}

	.actionBtn {
		height: 70px;
		width: 50% !important;
		font-weight: bold;
	}

	.carPrev, .carNext {
		direction: ltr !important;
	}

	form {
		width: 100%
	}

	.select2-selection__rendered {
		font-weight: normal;
	}

	.select2-selection__rendered, .select2-selection__arrow {
		margin-top: 3px;
	}

	span.select2-selection.select2-selection {
		height: 36px !important;
	}

	.FileTitle {
		position: absolute;
		bottom: 42px;
		display: flex;
		background: #6b686866;
		width: 100%;
		align-items: center;
		justify-content: center;
		color: #0a1332;
		margin: 0;
		border-radius: 6px 9px 0 0;
	}

	label.control-label::after {
		content: ":";
	}

	label.control-label {
		font-weight: bold;
	}

	#CodeGenrateDiv {
		display: inline-flex;
		width: 100%;
		align-items: center;
		justify-content: flex-start;
		direction: ltr !important;
		margin: 10px 0
	}

		#CodeGenrateDiv input {
			border: 1px solid;
			margin: 0 5px;
			width: 40px;
			text-align: center !important;
			background: #ececec;
			font-weight: bold;
		}

	.FileTitle p {
		margin: 0;
		padding: 1px 0px;
		white-space: nowrap;
		font-size: 10px;
	}

	table#PDFTable {
		font-family: arial, sans-serif;
		border-collapse: collapse;
		width: 100%;
		margin-bottom: 29px;
	}

	#padf div img {
		width: 120px !important;
	}

	#padf {
		overflow-y: auto;
		overflow-x: hidden;
		height: 454px;
		width: 650px;
	}

	.boldtitle {
		font-weight: 900;
		padding: 5px 0;
		font-size: 21px;
	}


	table#PDFTable tbody tr th {
		text-align: start !important;
		/*font-family: 'DroidArabicKufiRegular' !important;*/
		font-size: 14px;
		padding: 6px 19px;
	}

		table#PDFTable tbody tr th:not(.boldtitle) {
			border: 1px solid #eee;
		}

			table#PDFTable tbody tr th:not(.boldtitle):nth-of-type(2n) {
				font-weight: normal
			}

		table#PDFTable tbody tr th.boldtitle {
			font-size: 20px;
			color: #283858;
		}

	.PDFOuterView {
		display: flex;
		align-items: center;
		justify-content: center;
	}
</style>
@{
	var isAr = Request.Cookies["lang"].Value == "ar";
	var url = ConfigurationManager.AppSettings["DomainName"].ToString();
}
@Html.Hidden("Language", isAr, new { @id = "Language" })
<div class="row">
	<div class="col-12">
		<div class="mb-3">
			@*<span style="display:none" id="NONE">@Model.Request_Data_ID</span>*@
			<div class="card">
				<div class="card-body">
					<div class="media mb-4 justify-content-center align-content-center  d-inline-flex justify-content-between w-100">
						<i class="rounded-circle header-profile-user bx bx-user font-size-16 align-middle mr-1" style=" display: flex; justify-content: center; align-items: center;font-size: 43px !important;height:100%"></i>						<div class="media-body">
							<h5 class="font-size-14 mt-1 en-font">@Model.Personel_Data.First_Name</h5>
							<small class="text-muted en-font">@Model.Personel_Data.Email</small>
						</div>
						<a href="/Email" key="t-backToEmail" class="btn btn-primary">Back To Home</a>
					</div>
					<div class="PDFOuterView">
						<div id="padf" class="pdfnotloaded">
							<div style="padding: 15px;display: inline-flex;justify-content: space-between;width: 100%;">
								<img src="~/assets/images/MousLogo2.png">
								<img src="~/assets/images/VisionLogo.png">
							</div>
							<table class='container' id="PDFTable" style="width: 100%;padding: 15px;">
								<tbody>
									<tr>
										<th class="boldtitle" key="t-summary"></th>
									</tr>
									<tr>
										<th key="t-serviceType"></th>
										<th>@(isAr ? Model.Service_Type.Service_Type_Name_AR : Model.Service_Type.Service_Type_Name_EN)</th>
									</tr>
									<tr>
										<th key="t-reqtype"></th>
										<th>@(isAr ? Model.Request_Type.Request_Type_Name_AR : Model.Request_Type.Request_Type_Name_EN)</th>
									</tr>
									<tr>
										<th key="t-Provider"></th>
										<th>@((ViewBag.Units as IEnumerable<SelectListItem>).First(q => q.Value == Model.Unit_ID.ToString()).Text)</th>
									</tr>
									<tr>
										<th class="boldtitle" key="t-personalData"></th>
									</tr>
									<tr>
										<th class="boldtitle" key="t-genralInfo"></th>
									</tr>
									<tr>
										<th key="t-IAUAff"></th>
										<th><span key="@(Model.Personel_Data.IAU_ID_Number != null ? "t-yes" : "t-no")"></span></th>
									</tr>
									<tr>
										<th key="t-applicanttype"></th>
										<th>@(isAr ? Model.Personel_Data.Applicant_Type.Applicant_Type_Name_AR : Model.Personel_Data.Applicant_Type.Applicant_Type_Name_EN)</th>
									</tr>
									<tr>
										<th key="t-firstname"></th>
										<th>@Model.Personel_Data.First_Name</th>
									</tr>
									<tr>
										<th key="t-middlename"></th>
										<th>@Model.Personel_Data.Middle_Name</th>
									</tr>
									<tr>
										<th key="t-lastname"></th>
										<th>@Model.Personel_Data.Last_Name</th>
									</tr>
									<tr>
										<th class="boldtitle" key="t-nationalty"></th>
									</tr>
									<tr>
										<th key="t-nationalty"></th>
										<th>@(isAr ? Model.Personel_Data.Country.Country_Name_AR : Model.Personel_Data.Country.Country_Name_EN)</th>
									</tr>
									<tr>
										<th key="t-country"></th>
										<th>@(isAr ? Model.Personel_Data.Country1.Country_Name_AR : Model.Personel_Data.Country1.Country_Name_EN)</th>
									</tr>
									<tr>
										<th key="t-iddoc"></th>
										<th>@(isAr ? Model.Personel_Data.ID_Document1.Document_Name_AR : Model.Personel_Data.ID_Document1.Document_Name_EN)</th>
									</tr>
									<tr>
										<th key="t-idnumber"></th>
										<th class="en-font">@(Model.Personel_Data.ID_Number)</th>
									</tr>
									<tr>
										<th class="boldtitle" key="t-address"></th>
									</tr>
									<tr>
										<th key="t-city"></th>
										<th>@Model.Personel_Data.Address_City</th>
									</tr>
									<tr>
										<th key="t-region"></th>
										<th>@Model.Personel_Data.Adress_Region</th>
									</tr>
									@*<tr>
											<th key="t-country"></th>
											<th>@(isAr ? Model.Personel_Data.Country2.Country_Name_AR : Model.Personel_Data.Country2.Country_Name_EN)</th>
										</tr>*@
									<tr>
										<th key="t-postal"></th>
										<th class="en-font">@Model.Personel_Data.Postal_Code</th>
									</tr>
									<tr>
										<th class="boldtitle" key="t-contactinfo"></th>
									</tr>
									<tr>
										<th key="t-email"></th>
										<th class="en-font">@Model.Personel_Data.Email</th>
									</tr>
									<tr>
										<th key="t-phone"></th>
										<th class="en-font" style="direction:ltr;text-align:start;@(isAr ? "text-align: end !important;" : "")">@Model.Personel_Data.Mobile</th>
									</tr>

								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			@{
				var IsMos = (TempData["IsMostafid"] as Nullable<bool>);
				var ShowEncode = Model.TempCode == "" || Model.TempCode == null;
			}
			<div class="card">
				<div class="card-body">
					<div class="row">
						@{

							var MostafidComments = (ViewBag.RequestTransaction as ICollection<IAUAdmin.DTO.Entity.Request_TransactionDTO>);
							var MostafidComment = MostafidComments.Count == 0 ? new IAUAdmin.DTO.Entity.Request_TransactionDTO() : MostafidComments.Last();
							var ShowStaticCode = Model.TempCode == "" || Model.TempCode == null;
							<div class="col-12">
								<div class="row">
									@*<label class="control-label" key="t-title-unitrefnum" for="servicetype">Code</label>*@
									<div class="@(ShowStaticCode?"col-12":"col-9")" style="display:inline-flex;@(ShowStaticCode?"justify-content: center;":"justify-content: flex-start;")" id="CodeGenrateDiv">
										@if (ShowStaticCode)
										{
											<input class="form-control Genratedcode en-font" value="1" readonly disabled />
											foreach (var i in new string[12])
											{
												<input class="form-control Genratedcode en-font" value="0" readonly disabled />
											}
										}
										else
										{
											foreach (var i in Model.TempCode.ToCharArray())
											{
												<input class="form-control Genratedcode en-font" value="@i" readonly disabled />
											}
										}
									</div>
									<div class="col-3" style="justify-content: space-between;align-items: center;display: flex;">
										@if (!ShowStaticCode && Model.GenratedDate != null)
										{
											<span style="direction:ltr;padding: 12px;border-radius: 15px;background: darkgreen;color: white;">
												@(Model.GenratedDate.Value.ToString("dd MMM HH:mm"))
											</span>
											<div class="form-group">
												<label key="t-ExpectedTime" class="control-label">الوقت المتوقع</label>
												<input name="ExpectedDate" dir="@(isAr ? "rtl" : "ltr")" type="date" class="form-control  en-font" value="@(TimeZoneInfo.ConvertTime(DateTime.Now, TimeZoneInfo.FindSystemTimeZoneById("Egypt Standard Time")).AddDays(2).ToString("yyy-MM-dd"))" />
											</div>
										}
									</div>
								</div>
							</div>

						}
						<div class="col-12">
							@*@Html.Hidden("BuildNumberdata", Model.Units.Building_Number, new { @id = "BuildNumber-data" })*@

							@if (ShowEncode)
							{
								using (Html.BeginForm("Codeing", "Email", FormMethod.Post, new { @enctype = "multipart/form-data" }))
								{
									@Html.Hidden("RequestIID", Model.Request_Data_ID)

									<div class="row">
										<div class="col-4">
											<div class="form-group">
												<label key="t-e-source" class="control-label">المصدر</label>
												@Html.DropDownListFor(model => model.IsTwasul_OC, ViewBag.Source as IEnumerable<SelectListItem>, new { @class = "select2 form-control", @onchange = "Level(event.target.value)", @name = "source", @dir = @Request.Cookies["lang"].Value == "ar" ? "rtl" : "ltr" })
											</div>
											<div class="form-group">
												<label key="t-title-mainservice" class="control-label">نوع الخدمة الرئيسية</label>
												@Html.DropDownListFor(model => model.Service_Type_ID, ViewBag.ServiceType as SelectList, new { @class = "select2 form-control", @name = "serviceType", @onchange = "ServiceChange(event.target.value)", @id = "ServiceType", @dir = @Request.Cookies["lang"].Value == "ar" ? "rtl" : "ltr" })
											</div>
											<div class="form-group">
												<label key="t-reqtype" class="control-label">توع الطلب</label>
												@Html.DropDownListFor(model => model.Request_Type_ID, ViewBag.ReqTypes as SelectList, new { @class = "select2 form-control", @name = "reqType", @onchange = "RequestChange(event.target.value)", @id = "ReqestType", @dir = @Request.Cookies["lang"].Value == "ar" ? "rtl" : "ltr" })
											</div>
										</div>
										<div class="col-4">
											<div class="form-group" style="height:63px;display:flex;align-items:center">
												<label key="t-LocationSetting" class="control-label m-0">اعدادات الموقع</label>
											</div>
											<div class="form-group">
												<label key="t-location" class="control-label">الموقع</label>
												@Html.DropDownListFor(q => q.Units.Units_Location_ID, (ViewBag.Locations as SelectList).Prepend(new SelectListItem() { Text = isAr ? "الكل" : "All", Value = "null" }), new { @class = "select2 form-control ", @id = "location", @onchange = "LocChange(event.target.value)", @dir = @Request.Cookies["lang"].Value == "ar" ? "rtl" : "ltr" })
											</div>
											<div class="form-group">
												<label key="t-Buiding" class="control-label">الميني</label>
												<select id="Building" name="BuildingSelect" class="form-control select2" onchange="BuildChange(event.target.value)">
													<option value="null" selected>@(isAr ? "الكل" : "ALL")</option>
												</select>
											</div>
										</div>
										<div class="col-4">
											<div class="form-group">
												<label key="t-Provider" class="control-label">مقدم الخدمة</label>
												@Html.DropDownListFor(q => q.Unit_ID, ViewBag.Units as IEnumerable<SelectListItem>, new { @class = "select2 form-control", @onchange = "GetCode()", @name = "unit", @id = "UnitsDataSelect", @dir = @Request.Cookies["lang"].Value == "ar" ? "rtl" : "ltr" })
											</div>
											<div class="form-group">
												<label key="t-ExpectedTime" class="control-label">الوقت المتوقع</label>
												<input name="ExpectedDate" dir="@(isAr ? "rtl" : "ltr")" type="date" class="form-control  en-font" value="@(TimeZoneInfo.ConvertTime(DateTime.Now, TimeZoneInfo.FindSystemTimeZoneById("Egypt Standard Time")).AddDays(2).ToString("yyy-MM-dd"))" />
											</div>
											<div class="form-group">
												<label key="t-activeTitle" class="control-label">الميني</label>
												<select id="SSSSstatus" name="BuildingSelect" class="form-control select2">
													@foreach (var i in ViewBag.Status as ICollection<IAUAdmin.DTO.Entity.RequestStatusDTO>)
													{
														<option value="@i.State_ID" @(Model.Request_State_ID == i.State_ID ? "selected" : "") disabled>@(isAr ? i.StateName_AR : i.StateName_EN)</option>
													}
												</select>
											</div>
											@Html.Hidden("type", "c")
										</div>
									</div>

									<button style="display:none;" id="SubmitEncode" type="submit"></button>
								}
							}

							@if (Model.TempCode != "" && Model.TempCode != null)
							{
								using (Html.BeginForm("Forward", "Email", FormMethod.Post, new { @enctype = "multipart/form-data", @style = "display:none!important" }))
								{
									@Html.Hidden("RequestIID", Model.Request_Data_ID)
									@Html.Hidden("Unit_ID", Model.Unit_ID)
									<input name="Expected" type="date" class="form-control  en-font" />
									<input name="MosComment" id="Mostafidcomment" type="text" class="form-control" />
									<button style="display:none;" id="SubmitForwared" type="submit"></button>
								}
							}
							@if (ShowEncode && MostafidComment.CommentType.HasValue && MostafidComment.CommentType == 1)
							{

								using (Html.BeginForm("CloseRequest", "Email", FormMethod.Post, new { @enctype = "multipart/form-data", @style = "display:none!important" }))
								{
									@Html.Hidden("RequestIID", Model.Request_Data_ID)
									<button style="display:none;" id="SubmitClose" type="submit"></button>
								}
							}

						</div>
					</div>
				</div>
			</div>
			<div class="card">
				<div class="card-body">
					<div class="row">
						<div class="container">
							<ul class="nav nav-tabs tabs-marker tabs-dark" style="margin-bottom:21px" id="myTab" role="tablist">
								<li class="nav-item">
									<a class="nav-link active  btn btn-primary" id="home" data-toggle="tab" href="#home-tab2" role="tab" aria-controls="home" aria-selected="true"><span key="t-NewComment"></span><span class="marker"></span></a>
								</li>
								@if (ViewBag.RequestTransaction.Count != 0)
								{
									<li class="nav-item">
										<a class="nav-link btn btn-primary" id="profile" data-toggle="tab" href="#profile-tab2" role="tab" aria-controls="profile" aria-selected="false"><span key="t-PreviousComment"></span><span class="marker"></span></a>
									</li>
								}
							</ul>
							<div class="tab-content" id="myTabContent">
								<div class="tab-pane fade show active" id="home-tab2" role="tabpanel" aria-labelledby="home-tab">
									<div class="col">
										<div class="summernote">
										</div>

									</div>
								</div>
								@{
									if (ViewBag.RequestTransaction.Count != 0)
									{
										var count = 0;
										<div class="tab-pane fade" id="profile-tab2" role="tabpanel" aria-labelledby="profile-tab">
											<div class="col">
												<div class="CustomeCarso">
													@foreach (var i in ViewBag.RequestTransaction as ICollection<IAUAdmin.DTO.Entity.Request_TransactionDTO>)
													{
														if (i.Comment != "" && i.Comment != null)
														{

															count++;
															<div class="data-Comment @(count == ViewBag.RequestTransaction.Count ? "active" : "")" data-id="@count">
																<div style="display:inline-flex;justify-content:space-between;width:100%">
																	<h3>@(isAr ? i.Units1.Units_Name_AR : i.Units1.Units_Name_EN)</h3>
																	<span>@i.CommentDate.Value.ToString("dd-MM-yy HH:mm")</span>
																</div>
																<div class="text" dir="@(isAr?"rtl":"ltr")">
																	@Html.Raw(i.Comment)
																</div>
															</div>
														}
													}
													<div class="row justify-content-between">
														@if (isAr)
														{
															<button class="btn btn-outline-primary carNext" dir="@(isAr?"rtl":"ltr")"><i class="fas fa-arrow-right"></i></button>
															<span style="direction:ltr"><span id="from-comment">@count</span> of <span id="total-comment">@count</span></span>
															<button class="btn btn-outline-primary carPrev" dir="@(isAr?"rtl":"ltr")"><i class="fas fa-arrow-left"></i></button>
														}
														else
														{
															<button class="btn btn-outline-primary carPrev" dir="@(isAr?"rtl":"ltr")"><i class="fas fa-arrow-left"></i></button>
															<span style="direction:ltr"><span id="from-comment">@count</span> of <span id="total-comment">@count</span></span>
															<button class="btn btn-outline-primary carNext" dir="@(isAr?"rtl":"ltr")"><i class="fas fa-arrow-right"></i></button>
														}
													</div>
												</div>

											</div>
										</div>
									}
								}
							</div>
						</div>
					</div>
				</div>
			</div>


			<div class="card">
				<div class="card-body">
					<div class="row">
						<div class="col-4">
							<p class="card-title-desc" key="t-RequiredDocs">
								الاوراق المطلوبة
							</p>
							<div class="row constainDocs" dir="@(isAr?"rtl": "ltr")">
								@foreach (var i in Model.Request_File.Where(q => q.RequiredDoc_ID != null))
								{
									<div class="col-3">
										<div class="card w-100">
											<i class="fas fa-file" data-toggle="tooltip" title="@((isAr ? i.Required_Documents.Name_AR : i.Required_Documents.Name_EN)+"\n"+i.File_Name)" style="    text-align: center;justify-self: center;font-size: 48px;margin-bottom: 24px;"></i>
											<div class="FileTitle row w-100">
												<p class="row" key="t-requirddoc">@(new string((isAr ? i.Required_Documents.Name_AR : i.Required_Documents.Name_EN).Take(10).ToArray()))</p>
												<p class="row">@(new string(i.File_Name.Take(12).ToArray()))</p>
											</div>
											<div class="py-2 text-center">
												<a target="_blank" href="@url/@i.File_Path" class="font-weight-medium" key="t-preview">Preview</a>
											</div>
										</div>
									</div>
								}
							</div>
						</div>
						<div class="col-4">
							<p class="card-title-desc" key="t-SupportiedDocs">
								الاوراق الداعمة
							</p>
							<div class="row constainDocs" dir="@(isAr?"rtl": "ltr")">
								@foreach (var item in new string[15])
								{
									foreach (var i in Model.Request_File.Where(q => q.RequiredDoc_ID == null))
									{
										<div class="col-3">
											<div class="card w-100">
												<i class="fas fa-file" data-toggle="tooltip" title="@i.File_Name" style="    text-align: center;justify-self: center;font-size: 48px;margin-bottom: 24px;"></i>
												<div class="FileTitle row">
													<p class="row">@(new string(i.File_Name.Take(12).ToArray()))</p>
												</div>
												<div class="py-2 text-center">
													<a target="_blank" href="@url/@i.File_Path" class="font-weight-medium" key="t-preview">Preview</a>
												</div>
											</div>
										</div>
									}
								}
								<div class="col-3">
									<div class="card" style="height: 92px;border: 2px dashed green;width:100%;display:flex;align-items:center;justify-content:center">
										<span>
											<i class="fas fa-file-upload card-img-top img-fluid" style="font-size:30px;color:green"></i>
										</span>
									</div>
								</div>
							</div>
						</div>
						<div class="col-4">
							<p class="card-title-desc" key="t-eforms">
								النماذج
							</p>
						</div>

					</div>
				</div>
			</div>


			<div class="card">
				<div class="card-body">
					@{
						var syle = "d-flex justify-content-center col-" + (MostafidComment.CommentType.HasValue && MostafidComment.CommentType == 1 ? (ShowEncode ? 4 : 6) : 6);
					}
					<div class="row">
						<div class="@syle">
							<button class="btn btn-primary w-100 actionBtn @(ShowEncode?"":"disabled")" id="sa-encode"><i class="fas fa-sort-amount-down"></i> <span style="margin:0 15px" key="t-encode">1 - تكويد الطلب</span></button>
						</div>
						<div class="@syle">
							<button class="btn btn-primary w-100 actionBtn" @(Model.TempCode != "" && Model.TempCode != null ? "" : "disabled") id="sa-forwared"><i class="far fa-share-square"></i> <span style="margin:0 15px" key="t-forward">2 -  توجيه الطلب</span></button>
						</div>
						@if (ShowEncode && MostafidComment.CommentType.HasValue && MostafidComment.CommentType == 1)
						{
							<div class="@syle justify-content-center d-flex">
								<button class="btn btn-danger actionBtn" id="sa-close"><i class="fas fa-times-circle"></i><span style="margin:0 12px;" key="t-close">اغلاق الطلب</span></button>
							</div>
						}
					</div>
				</div>
			</div>

		</div>

	</div>
</div>
<!-- JAVASCRIPT -->
<script src="~/assets/libs/jquery/jquery.min.js"></script>

<script src="~/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="~/assets/libs/metismenu/metisMenu.min.js"></script>
<script src="~/assets/libs/simplebar/simplebar.min.js"></script>
<script src="~/assets/libs/node-waves/waves.min.js"></script>
<script src="~/assets/js/lang/jquery.multiLanguage.js"></script>

<!-- Summernote js -->
<script src="~/assets/libs/summernote/summernote-bs4.min.js"></script>

<!-- email summernote init -->
<script src="~/assets/js/pages/email-summernote.init.js"></script>

<!-- select 2 plugin -->
<script src="~/assets/libs/select2/js/select2.min.js"></script>

<!-- dropzone plugin -->
<script src="~/assets/libs/dropzone/min/dropzone.min.js"></script>
<!-- Summernote js -->
<script src="~/assets/libs/summernote/summernote-bs4.min.js"></script>
<!-- Sweet Alerts js -->
<script src="~/assets/libs/sweetalert2/sweetalert2.min.js"></script>
<!-- init js -->
<script src="~/assets/js/pages/ecommerce-select2.init.js"></script>
<!-- App js -->
<script src="~/assets/js/app.js"></script>
<script src="~/assets/js/pdf.js"></script>
<script src="~/assets/js/pdf.worker.js"></script>
<script>
	let toal = parseInt($('#total-comment').text());
	let activeComment = parseInt($('#total-comment').text());
	$('.carNext').on('click', function () {
		activeComment = ((activeComment++) % toal) + 1;
		$('#from-comment').text(activeComment)
		$('.data-Comment').removeClass('active');
		$(`.data-Comment[data-id='${activeComment}']`).addClass('active');
	})
	$('.carPrev').on('click', function () {
		activeComment = activeComment - 1 == 0 ? toal : activeComment - 1;
		$('#from-comment').text(activeComment)
		$('.data-Comment').removeClass('active');
		$(`.data-Comment[data-id='${activeComment}']`).addClass('active');
	})
</script>
@if (ShowEncode && MostafidComment.CommentType.HasValue && MostafidComment.CommentType == 1)
{
	<script>
		$('#sa-close').click(function () {
		Swal.fire({
			title:"@(isAr ? "هل انت متاكد من اغلاق هذا الطلب؟" : "Are you sure To Close this request?")",
			text: "@(isAr?"سيتم ارسال رسالة للمستفيد تفيد بانه تم الانتهاء من الطلب , للمتابعة اضغط موافق":"A message will be sent to the beneficiary stating that the application has been completed and proceeded, press Yes")",
			icon: "warning",
			showCancelButton: true,
			focusConfirm: false,
			confirmButtonColor: "#34c38f",
			cancelButtonColor: "#f46a6a",
			confirmButtonText: "@(isAr?"موافق , اغلق الطلب":"Yes, Close it!")",
			cancelButtonText: "@(isAr?"الغاء العملية":"Cancel Process")",
		}).then(function (result) {
			if (result.value) {
				$('#SubmitClose').click();
			}
		});
	});
	</script>
}
@if (ShowEncode)
{
	<script>

		$('#sa-encode').click(function () {
			Swal.fire({
				title:"@(isAr ? "هل انت متاكد من تكويد هذا الطلب؟" : "Are you sure To Codeing this request?")",
				text: "@(isAr?"لن تستطيع ارجاع ذلك بعد اتمام العملية!":"You won't be able to revert this!")",
				icon: "warning",
				showCancelButton: true,
				focusConfirm: false,
				confirmButtonColor: "#34c38f",
				cancelButtonColor: "#f46a6a",
				confirmButtonText: "@(isAr?"موافق":"Yes")",
				cancelButtonText: "@(isAr?"الغاء العملية":"Cancel Process")",
			}).then(function (result) {
				if (result.value) {
					$('#SubmitEncode').click();
				}
			});
		});
	 GetCode()

	function ServiceChange(id) {
		$.ajax({
			url: "/Email/GetRequesType?ID=" + id, method: "GET", type: 'json', success: function (x) {
				let data = JSON.parse(x);
				if (data.success) {
					$('#ReqestType').html('');
					console.log(data)
					data.result.forEach(e => {
						$('#ReqestType').append(`<option value="${e["ID"]}">${($('#Language').val() ? e["Name_AR"] : e["Name_EN"])}</option>`);
					})
				}
				GetUnots();
			}
		})
	}
	function RequestChange(id) {
		GetUnots()
	}
	function Level(id) {
		document.getElementsByClassName('Genratedcode')[0].value = $("[name='source']").val() ? "1" : "2"
	}
	function LocChange(id) {
		$.ajax({
			url: "/Email/GetBuildings?ID=" + id, method: "GET", type: 'json', success: function (x) {
				let data = JSON.parse(x);
					$('#Building').html('<option value="null" selected>@(isAr ? "الكل" : "ALL")</option>');
				if (data.success) {
					let BuildNum = $('#BuildNumber-data').val()
					data.result.forEach(e => {
						$('#Building').append(`<option ${BuildNum==e?'selected':''} value="${e}">${e}</option>`);
					})
				}
				GetUnots()
			}
		})
	}
	function BuildChange(id) {
		GetUnots();
	}
	function GetUnots() {
		$.ajax({
			url: `/Email/GetUnits?SID=${$('#ServiceType').val()}&RID=${$('#ReqestType').val()}&Loc=${$('#location').val()}&Building=${$('#Building').val()}`, method: "GET", type: 'json', success: function (x) {
				let data = JSON.parse(x)
				if (data.success) {
					$('#UnitsDataSelect').html('');
					data.result.forEach(e => {
						$('#UnitsDataSelect').append(`<option value="${e["Units_ID"]}">${($('#Language').val() ? e["Units_Name_AR"] : e["Units_Name_EN"])}</option>`);
					})
				}
				GetCode()
			}
		})

	}
	function GetCode() {
		if ($('#UnitsDataSelect').val() != null) {
			$.ajax({
				url: `/Email/GetCode?RequestIID=${$('#RequestIID').val()}&IsTwasul_OC=${$("[name='IsTwasul_OC']").val()}&Service_Type_ID=${$('#ServiceType').val()}&Request_Type_ID=${$('#ReqestType').val()}&locations=${$('#location').val()}&BuildingSelect=${$('#Building').val()}&Unit_ID=${$('#UnitsDataSelect').val()}&type=c`, method: "GET", type: 'json', success: function (x) {
					let Code = JSON.parse(x)["result"].split('');
					([...document.getElementsByClassName('Genratedcode')]).map((le, i) => {
						le.value = Code[i]
					})
				}
			})
		}
	}
	</script>
}
@if (Model.TempCode != "" && Model.TempCode != null)
{
	<script>
		$('#sa-forwared').click(function () {
		Swal.fire({
			title:"@(isAr ? "هل انت متاكد من توجيه هذا الطلب؟" : "Are you sure To Forward this request?")",
			text: "@(isAr?"لن تستطيع ارجاع ذلك بعد اتمام العملية!":"You won't be able to revert this!")",
			icon: "warning",
			showCancelButton: true,
			focusConfirm: false,
			confirmButtonColor: "#34c38f",
			cancelButtonColor: "#f46a6a",
			confirmButtonText: "@(isAr?"موافق , توجيه الطلب":"Yes, Forwared it!")",
			cancelButtonText: "@(isAr?"الغاء العملية":"Cancel Process")",
		}).then(function (result) {
			if (result.value) {
				$("[name='Expected']").val($("[name='ExpectedDate']").val());
				$('#Mostafidcomment').val($('.note-editable.card-block').html())

				$('#SubmitForwared').click();
			}
		});
	});
	</script>
}
<script>
	$(document).ready(function () {
		$('[data-toggle="tooltip"]').tooltip();
	});
</script>
